---
import '../styles/tokens.css';
import '../styles/app.css';

interface Props {
  title?: string;
}

const { title = 'Dona' } = Astro.props;
const user = Astro.locals.user;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="app-nav">
      <div class="nav-inner">
        <a href="/dashboard" class="nav-logo">Dona</a>
        <button class="hamburger" aria-label="Toggle menu" aria-expanded="false">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="nav-links">
          <a href="/dashboard" class="nav-link">Dashboard</a>
          <a href="/restaurant" class="nav-link">Restaurant</a>
          <a href="/menus" class="nav-link">Menus</a>
          <div class="nav-spacer"></div>
          <span class="nav-user">{user?.name || user?.email}</span>
          <form method="POST" action="http://localhost:4000/api/auth/logout" id="logout-form">
            <button type="submit" class="nav-link nav-logout">Logout</button>
          </form>
        </div>
      </div>
    </nav>
    <main class="app-main">
      <slot />
    </main>
    <script>
      const hamburger = document.querySelector('.hamburger');
      const navLinks = document.querySelector('.nav-links');
      if (hamburger && navLinks) {
        hamburger.addEventListener('click', () => {
          const expanded = hamburger.getAttribute('aria-expanded') === 'true';
          hamburger.setAttribute('aria-expanded', String(!expanded));
          navLinks.classList.toggle('open');
        });
      }

      const logoutForm = document.getElementById('logout-form');
      if (logoutForm) {
        logoutForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          await fetch('http://localhost:4000/api/auth/logout', {
            method: 'POST',
            credentials: 'include',
          });
          window.location.href = '/';
        });
      }
    </script>
  </body>
</html>
